apiVersion: redhatcop.redhat.io/v1alpha1
kind: VaultSecret
metadata:
    name: registry-credentials
spec:
  vaultSecretDefinitions:
  - authentication:
      path: kubernetes
      role: {{ .Values.app.name }}-vault-role
    name: registrytoken
    # path: kv/secrets/rhdhidp/registry
    path: quay/creds/{{ .Values.app.name }}
  output:
    name: {{ .Values.app.name }}-registry-creds
    type: kubernetes.io/dockerconfigjson
    # "auth": "{{ "{{" }}.registrytoken.username{{ "}}" }}:{{ "{{" }}.registrytoken.password{{ "}}" }}",
    stringData:
      .dockerconfigjson: |
        {
          "auths": {
            "quay.io": {
              "auth": "{{ "{{" }}(print .registrytoken.username ":" .registrytoken.password) | b64enc {{ "}}" }}",
              "email": ""
            }
          }
        }